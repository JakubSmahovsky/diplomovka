principals: Alice, Bob

Bob [
  knows private sIKB
  distributed pIKB = PK(sIKB)
  distributed gIKB = 'g'^sIKB
  knows private sSPKB
]

Alice [
  knows private sIKA, plaintext
  knows public pIKB, gIKB
]

Bob [
  gSPKB = 'g'^sSPKB
  sigSPKB = SIGN(sIKB, gSPKB)
  generates sOPKB
  gOPKB = 'g'^sOPKB
]
Bob -> Alice: gSPKB, sigSPKB, gOPKB

Alice [
  SIGNVERIF(pIKB, gSPKB, sigSPKB)?
  gIKA = 'g'^sIKA
  generates sEKA
  gEKA = 'g'^sEKA
  DH1 = gSPKB^sIKA
  DH2 = gIKB^sEKA
  DH3 = gSPKB^sEKA
  DH4 = gOPKB^sEKA
  SK = HASH(DH1, DH2, DH3, DH4)
  AD = {gIKA, gIKB}
  message = ENC(SK, plaintext)
  MAC = HASH(SK, plaintext, AD)
]
Alice -> Bob: gIKA, gEKA, gOPKB, message, MAC

Bob [
  DH1 = gIKA^sSPKB
  DH2 = gEKA^sIKB
  DH3 = gEKA^sSPKB
  DH4 = gEKA^sOPKB
  SK = HASH(DH1, DH2, DH3, DH4)
  AD = {gIKA, gIKB}
  plaintext = DEC(SK, message)
  ASSERT(MAC, HASH(SK, plaintext, AD))?
]

queries [
  confidentiality? Bob's plaintext
]